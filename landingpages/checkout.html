<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
     <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/9.1.0/mdb.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
   <!-- navigation bar starts here -->
<nav class="navbar navbar-expand-lg  px-lg-5">
  <div class="container-fluid">
    <a class="navbar-brand" href="../index.html"><img class="me-lg-5" src="../images/Foodies logo without Banner 1.png" alt=""></a>
    <a href="./cart.html" class="ms-3 position-relative cart-nav">
          <i class="fa-solid fa-bag-shopping fa-2x" style="color: #0f0b0b;"></i>
          <span id="cartCount1" 
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning">
            0
          </span>
        </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse " id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-lg-0 fs-5 fw-bold">
        <li class="nav-item">
          <a class="nav-link active  ms-lg-5" aria-current="page" href="../index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="./our-products.html">Our Products</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="./health-benefits.html">Health Benefits</a>
        </li>
         <li class="nav-item">
          <a class="nav-link " href="#">Blog</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            FAQs
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item  fs-5 fw-bold" href="#">About You</a></li>
            
          </ul>
        </li>
      </ul>
      <form class="d-flex" role="search">
          <a class="nav-link" href="#"><i class="fa-solid fa-magnifying-glass fa-2x" style="color: #0f0b0b;"></i></a>
         <a class="link-secondary ms-3" href="#">
        <i class="fa-regular fa-heart fa-2x " style="color: #0f0b0b;"></i>
      </a>
     <!-- Navbar Cart Icon -->
        <a href="./cart.html" class="ms-3 position-relative">
          <i class="fa-solid fa-bag-shopping fa-2x" style="color: #0f0b0b;"></i>
          <span id="cartCount" 
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning">
            0
          </span>
       <a href="./login.html" id="userLink">
        <div class="d-inline-flex position-relative ms-3">
          <span id="userStatusDot" class="position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle" style="display:none;">
            <span class="visually-hidden">Logged in</span>
          </span>
          <i class="fa-regular fa-user fa-2x" style="color: #0f0b0b;"></i>
        </div>
      </a>
        <button class="btn btn-lg btn-success ms-3" type="submit">Contact Us</button>
      </form>
    </div>
  </div>
</nav>
<!-- navigation bar ends here -->
    
<section class="px-lg-5 my-5">
    <div class="row pt-lg-5">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
            <p class="bill fs-3 fw-bold" style="color: #131717;">Billing Details</p>
            <form action="#" class="check-input">
                <!-- email address input  -->
                <div class="form-outline" data-mdb-input-init>
                    <input type="email" id="email" class="form-control" />
              
                </div>
                <!-- residential address input -->
                 <p class="fw-bold fs-5 mt-4">Deliver to</p>
                 <select class="form-select fs-5" style="color: #566363;" aria-label="Default select example">
                    <option selected>Residence</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                </select>
                <!-- country input -->
                 <p class="fw-bold fs-5 mt-4">Country</p>
                 <select id="country" class="form-select fs-5">
                  <option value="Nigeria" selected>Nigeria</option>
                </select>
                <!-- 2 column grid layout with text inputs for the first and last names -->
                <div class="row mb-4 g-0 mt-4">
                    <div class="col">
                        <div data-mdb-input-init class="form-outline">
                            <input type="text" id="firstName" class="form-control" />
                         
                        </div>
                     </div>
                    <div class="col ps-3">
                        <div data-mdb-input-init class="form-outline">
                            <input type="text" id="lastName" class="form-control" />
                        </div>
                    </div>
                </div>
                <!-- text input for address -->
                 <div class="form-outline" data-mdb-input-init>
                     <input type="text" id="address" class="form-control" />
                    <label class="form-label fs-5 mt-2" for="address">Your address</label>
                </div>
                <!-- zip code and co input -->
                 <div class="row mb-4 g-0 mt-4">
                    <div class="col">
                        <div data-mdb-input-init class="form-outline">
                            <select id="city" class="form-select fs-5">
                              <option value="">Select City</option>
                            </select>
                        </div>
                     </div>
                     <div class="col px-3">
                        <select class="form-select fs-5" style="color: #566363;" aria-label="Default select example">
                            <option selected>Ikeja</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                     </div>
                    <div class="col">
                        <div data-mdb-input-init class="form-outline">
                            <select id="state" class="form-select fs-5">
                              <option value="">Select State</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- phone number input -->
                 <div class="form-outline" data-mdb-input-init>
                    <input type="number" id="phone" class="form-control" />
                    
                </div>
                <!-- text area input -->
                 <div class="mt-4">
                    <p class="fs-5">Order Note <span style="color: #566363;">(optional)</span></p>
                    <div class="form-outline" data-mdb-input-init>
                        <textarea class="form-control" id="orderNote" rows="8"></textarea>
                        <label class="form-label fs-5" for="orderNote">Tell us what do you think</label>
                    </div>
                 </div>
            </form>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6 ps-lg-5 mt-lg-0 mt-5">
          <p class="bill fs-3 fw-bold" style="color: #131717;">Your Order</p>
          <!-- price details section  -->
          <div id="orderSummary1"></div>
          
        </div>
</section>


<!-- Footer -->
<footer class="text-center text-lg-start text-muted mt-5">
  <!-- Section: Social media -->
  <section class="text-center p-4 border-bottom">
  <p class="fs-2 fw-bold text-light footer-h6">Excellent</p>
  <img src="../images/stars.png" alt="">
  <p class="fs-5 text-light mt-3">Based on <u>13,586 reviews</u></p>
  <img src="../images/pilot.png" alt="" class="pb-lg-4">
  </section>
  <!-- Section: Social media -->

  <!-- Section: Links  -->
  <section class="links">
    <div class="container text-center text-md-start mt-5">
      <!-- Grid row -->
      <div class="row mt-3">
        <!-- Grid column -->
        <div class="col-md-12 col-lg-3 col-xl-3 mx-auto mb-4">
          <!-- Content -->
          <h6 class="fw-bold mb-4 fs-5">Customer Service</h6>
          <p class="fs-5">Order Lookup</p>
          <p class="fs-5">Bulk Order</p>
          <p class="fs-5">Shipping & Delivery</p>
          <p class="fs-5">Discounts</p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-12 col-lg-2 col-xl-2 mx-auto mb-4">
          <!-- Links -->
          <h6 class="fw-bold mb-4 fs-5">
            About Us
          </h6>
          <p>
            <a href="#!" class="text-reset fs-5">News & Blog</a>
          </p>
          <p>
            <a href="#!" class="text-reset fs-5">Suppliers</a>
          </p>
          <p>
            <a href="#!" class="text-reset fs-5">Terms & Conditions</a>
          </p>
          <p>
            <a href="#!" class="text-reset fs-5">Privacy Policy</a>
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-12 col-lg-2 col-xl-2 mx-auto mb-4 fs-5">
          <!-- Links -->
          <h6 class=" fw-bold mb-4 fs-5">
            Need Help?
          </h6>
          <p>
            <a href="#!" class="text-reset">Contact Us</a>
          </p>
          <p>
            <a href="#!" class="text-reset">FAQs</a>
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column --> 
        <div class="col-md-12 col-lg-2 col-xl-2 mx-auto mb-md-0 mb-4 fs-5">
          <!-- Links -->
          <h6 class="fw-bold mb-4 fs-5">Privacy Policy</h6>
          <p>Terms & Conditions</p>
          <p>Privacy Policy</p>
        </div>
        <!-- Grid column -->
         <div class="col-md-12 col-lg-3 col-xl-3 mx-auto fs-5">
          <h6 class="fw-bold mb-4 fs-5">Follow Us</h6>
          <div>
            <a href="#" class="me-4 text-reset"><i class="fa-brands fa-square-facebook fa-2x" style="color: #f58634;"></i></a>
            <a href="#" class="me-4 text-reset"><i class="fa-brands fa-linkedin fa-2x" style="color: #f58634;"></i></a>
            <a href="#" class="me-4 text-reset"><i class="fa-brands fa-square-twitter fa-2x" style="color: #f58634;"></i></a>
          </div>
         </div>
      </div>
      <!-- Grid row -->
    </div>
  </section>
  <!-- Section: Links  -->

  <!-- Copyright -->
  <div class="text-center p-4" style="background-color: #D9D9D9;">
   <div class="row">
    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
      <img src="../images/footer logo.png" alt="">
    </div>
    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
      <img src="../images/pay.png" alt="" class="mt-4">
    </div>
    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
      <p class="text-dark mt-4">Copyright © 2024 FoodieAmazon. All Rights Reserved</p>
    </div>

   </div>
  </div>
  <!-- Copyright -->
</footer>
<!-- Footer -->


          
    </div>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js" integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/9.1.0/mdb.umd.min.js"></script>
     <script src="../index.js"></script>
     <script src="../cart.js"></script>
<!-- 
<script>
function parseJwt(token) {
  try {
    const base64Url = token.split(".")[1];
    const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
    return JSON.parse(window.atob(base64));
  } catch (err) {
    console.error("❌ Invalid token", err);
    return null;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("placeOrderBtn");
  if (!btn) return console.error("❌ placeOrderBtn not found in DOM");

  btn.addEventListener("click", async (e) => {
    e.preventDefault();
    console.log("🟢 Place Order clicked");

    // Collect form values
    const firstName = document.getElementById("firstName")?.value.trim();
    const lastName = document.getElementById("lastName")?.value.trim();
    const email = document.getElementById("email")?.value.trim();
    const phone = document.getElementById("phone")?.value.trim();
    const state = document.getElementById("state")?.value.trim();
    const city = document.getElementById("city")?.value.trim();

    if (!firstName || !lastName || !email || !phone || !state || !city) {
      return Swal.fire({
        icon: "warning",
        title: "Missing Information",
        text: "Please fill in all required fields.",
        confirmButtonColor: "#F58634"
      });
    }

    // Decode token to get customerId
    const token = localStorage.getItem("authToken");
    const decoded = parseJwt(token);
    const customerId = decoded?.id || decoded?._id || decoded?.userId;

    if (!customerId) {
      return Swal.fire({
        icon: "warning",
        title: "Login Required",
        text: "You must be logged in to place an order.",
        confirmButtonColor: "#F58634"
      }).then(() => window.location.href = "./login.html");
    }

    // Load cart
    const cart = JSON.parse(localStorage.getItem("site_cart_v1")) || [];
    if (!cart.length) {
      return Swal.fire({
        icon: "warning",
        title: "Empty Cart",
        text: "Your cart is empty. Please add items before placing an order.",
        confirmButtonColor: "#F58634"
      });
    }


    // Format items & calculate totals
    const items = cart.map(item => ({
      productId: item.id,
      name: item.name,
      image: item.image,
      price: item.price,
      quantity: item.quantity,
      subTotal: item.price * item.quantity
    }));

    const originalPrice = items.reduce((acc, item) => acc + item.subTotal, 0);
    const savings = Math.round(originalPrice * 0.05);
    const estimatedTax = Math.round((originalPrice - savings) * 0.05);
    const total = originalPrice - savings + estimatedTax;

    // Step 1: Create order in your backend
    const orderPayload = {
      customerId,
      customerSnapshot: { firstName, lastName, email, phone, state, city },
      items,
      totalAmount: total,
    };

    console.log("🚀 Sending order payload:", orderPayload);

    let orderData;
    try {
      const response = await fetch("http://localhost:3001/amazon/document/api/orders/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(orderPayload),
      });
      console.log(response)


      if (!response.ok) {
        console.log(response)
        const text = await response.text();
        throw new Error(`Backend returned HTTP ${response.status}: ${text}`);
      }

      orderData = await response.json();
      console.log("🔵 Backend response:", orderData);

      if (!orderData.success || !orderData.orderId) {
        throw new Error(orderData.message || "Order creation failed");
      }

    } catch (err) {
      console.error("❌ Backend error:", err);
      return Swal.fire({
        icon: "error",
        title: "Order Failed",
        text: err.message,
        confirmButtonColor: "#F58634"
      });
    }

    // Step 2: Initialize Paystack payment
    const PAYSTACK_SECRET_KEY = "pk_test_7ad8c7c3f6689347207949dd85748cd04666ad11"; // Replace with your secret key
    const PAYSTACK_URL = "https://api.paystack.co/transaction/initialize";

    const paymentPayload = {
      email,
      amount: total * 100, // in kobo
      currency: "NGN",
       metadata: { orderId: order._id.toString() },
      callback_url: "http://127.0.0.1:5501/landingpages/payment-confirmation.html"
    };

    console.log("🚀 Initializing Paystack with payload:", paymentPayload);

    try {
      const response = await fetch(PAYSTACK_URL, {
        method: "POST",
        headers: {
          "Authorization": "Bearer pk_test_7ad8c7c3f6689347207949dd85748cd04666ad11",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(paymentPayload)
      });

      if (!response.ok) {
        const text = await response.text();
        throw new Error(`Paystack returned HTTP ${response.status}: ${text}`);
      }

      const paystackData = await response.json();
      console.log("🔵 Paystack response:", paystackData);

      if (!paystackData.status || !paystackData.data?.authorization_url) {
        throw new Error(paystackData.message || "Payment initialization failed");
      }

      // Success — redirect user
      Swal.fire({
        icon: "success",
        title: "Order Created!",
        text: "Redirecting to Paystack for secure payment...",
        showConfirmButton: false,
        timer: 2000
      }).then(() => window.location.href = paystackData.data.authorization_url);

    } catch (err) {
      console.error("❌ Paystack error:", err);
      Swal.fire({
        icon: "error",
        title: "Payment Initialization Failed",
        text: err.message,
        confirmButtonColor: "#F58634"
      });
    }
  });
});
</script> -->

<!-- <script>
function parseJwt(token) {
  try {
    const base64Url = token.split(".")[1];
    const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
    return JSON.parse(window.atob(base64));
  } catch (err) {
    console.error("❌ Invalid token", err);
    return null;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("placeOrderBtn");
  if (!btn) return console.error("❌ placeOrderBtn not found in DOM");

  btn.addEventListener("click", async (e) => {
    e.preventDefault();
    console.log("🟢 Place Order clicked");

    // Collect form values
    const firstName = document.getElementById("firstName")?.value.trim();
    const lastName = document.getElementById("lastName")?.value.trim();
    const email = document.getElementById("email")?.value.trim();
    const phone = document.getElementById("phone")?.value.trim();
    const state = document.getElementById("state")?.value.trim();
    const city = document.getElementById("city")?.value.trim();

    if (!firstName || !lastName || !email || !phone || !state || !city) {
      return Swal.fire({
        icon: "warning",
        title: "Missing Information",
        text: "Please fill in all required fields.",
        confirmButtonColor: "#F58634"
      });
    }

    // Decode token
    const token = localStorage.getItem("authToken");
    const decoded = parseJwt(token);
    const customerId = decoded?.id || decoded?._id || decoded?.userId;

    if (!customerId) {
      return Swal.fire({
        icon: "warning",
        title: "Login Required",
        text: "You must be logged in to place an order.",
        confirmButtonColor: "#F58634"
      }).then(() => window.location.href = "./login.html");
    }

    // Load cart
    const cart = JSON.parse(localStorage.getItem("site_cart_v1")) || [];
    if (!cart.length) {
      return Swal.fire({
        icon: "warning",
        title: "Empty Cart",
        text: "Your cart is empty. Please add items before placing an order.",
        confirmButtonColor: "#F58634"
      });
    }

    // Format items & totals
    const items = cart.map(item => ({
      productId: item.id,
      name: item.name,
      image: item.image,
      price: item.price,
      quantity: item.quantity,
      subTotal: item.price * item.quantity
    }));

    const originalPrice = items.reduce((acc, item) => acc + item.subTotal, 0);
    const savings = Math.round(originalPrice * 0.05);
    const estimatedTax = Math.round((originalPrice - savings) * 0.05);
    const total = originalPrice - savings + estimatedTax;

    // Step 1: Create order in backend
    const orderPayload = {
      customerId,
      customerSnapshot: { firstName, lastName, email, phone, state, city },
      items,
      totalAmount: total,
    };

    console.log("🚀 Sending order payload:", orderPayload);

    let orderData;
    try {
      const response = await fetch("http://localhost:3001/amazon/document/api/orders/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(orderPayload),
      });

      if (!response.ok) {
        const text = await response.text();
        throw new Error(`Backend returned HTTP ${response.status}: ${text}`);
      }

      orderData = await response.json();
      console.log("🔵 Backend response:", orderData);

      if (!orderData.success || !orderData.orderId) {
        throw new Error(orderData.message || "Order creation failed");
      }
    } catch (err) {
      console.error("❌ Backend error:", err);
      return Swal.fire({
        icon: "error",
        title: "Order Failed",
        text: err.message,
        confirmButtonColor: "#F58634"
      });
    }

    // Step 2: Initialize Paystack payment
    const PAYSTACK_SECRET_KEY = "sk_test_93a85e660c1083402a5a972033a25a5112a0c331";
    const PAYSTACK_URL = "https://api.paystack.co/transaction/initialize";
    const reference = `ORDER-${orderData.orderId}-${Date.now()}`;

    const paymentPayload = {
      email,
      amount: total * 100, // in kobo
      currency: "NGN",
      reference,
      metadata: { orderId: orderData.orderId },
      callback_url: "http://127.0.0.1:5501/landingpages/payment-confirmation.html"
    };

    console.log("🚀 Initializing Paystack with payload:", paymentPayload);

    try {
      const response = await fetch(PAYSTACK_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${PAYSTACK_SECRET_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(paymentPayload)
      });

      if (!response.ok) {
        const text = await response.text();
        throw new Error(`Paystack returned HTTP ${response.status}: ${text}`);
      }

      const paystackData = await response.json();
      console.log("🔵 Paystack response:", paystackData);

      if (!paystackData.status || !paystackData.data?.authorization_url) {
        throw new Error(paystackData.message || "Payment initialization failed");
      }

      Swal.fire({
        icon: "success",
        title: "Order Created!",
        text: "Redirecting to Paystack for secure payment...",
        showConfirmButton: false,
        timer: 2000
      }).then(() => window.location.href = paystackData.data.authorization_url);

    } catch (err) {
      console.error("❌ Paystack error:", err);
      Swal.fire({
        icon: "error",
        title: "Payment Initialization Failed",
        text: err.message,
        confirmButtonColor: "#F58634"
      });
    }
  });
});
</script> -->

<script>
function parseJwt(token) {
  try {
    const base64Url = token.split(".")[1];
    const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
    return JSON.parse(window.atob(base64));
  } catch (err) {
    console.error(":x: Invalid token", err);
    return null;
  }
}
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("placeOrderBtn");
  if (!btn) return console.error(":x: placeOrderBtn not found in DOM");
  btn.addEventListener("click", async (e) => {
    e.preventDefault();
    console.log(":large_green_circle: Place Order clicked");
    // Collect form values
    const firstName = document.getElementById("firstName")?.value.trim();
    const lastName = document.getElementById("lastName")?.value.trim();
    const email = document.getElementById("email")?.value.trim();
    const phone = document.getElementById("phone")?.value.trim();
    const state = document.getElementById("state")?.value.trim();
    const city = document.getElementById("city")?.value.trim();
    const address = document.getElementById("address")?.value.trim();

    if (!firstName || !lastName || !email || !phone || !state || !city || !address) {
      return Swal.fire({
        icon: "warning",
        title: "Missing Information",
        text: "Please fill in all required fields.",
        confirmButtonColor: "#F58634"
      });
    }
    // Decode token
    const token = localStorage.getItem("authToken");
    const decoded = parseJwt(token);
    const customerId = decoded?.id || decoded?._id || decoded?.userId;
    if (!customerId) {
      return Swal.fire({
        icon: "warning",
        title: "Login Required",
        text: "You must be logged in to place an order.",
        confirmButtonColor: "#F58634"
      }).then(() => window.location.href = "./login.html");
    }
    // Load cart
    const cart = JSON.parse(localStorage.getItem("site_cart_v1")) || [];
    if (!cart.length) {
      return Swal.fire({
        icon: "warning",
        title: "Empty Cart",
        text: "Your cart is empty. Please add items before placing an order.",
        confirmButtonColor: "#F58634"
      });
    }
    // Format items & totals
    const items = cart.map(item => ({
      productId: item.id,
      name: item.name,
      image: item.image,
      price: item.price,
      quantity: item.quantity,
      subTotal: item.price * item.quantity
    }));
    const originalPrice = items.reduce((acc, item) => acc + item.subTotal, 0);
    const savings = Math.round(originalPrice * 0.05);
    const estimatedTax = Math.round((originalPrice - savings) * 0.05);
    const total = originalPrice - savings + estimatedTax;
    // Step 1: Create order in backend (which also initializes Paystack)
    const orderPayload = {
      customerId,
      customerSnapshot: { firstName, lastName, email, phone, state, city, address },
      items,
      totalAmount: total,
    };
    console.log(":rocket: Sending order payload:", orderPayload);
    try {
      const response = await fetch("http://localhost:3001/amazon/document/api/orders/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(orderPayload),
      });
      if (!response.ok) {
        const text = await response.text();
        throw new Error(`Backend returned HTTP ${response.status}: ${text}`);
      }
      const orderData = await response.json();
      console.log(":large_blue_circle: Backend response:", orderData);
      if (!orderData.success || !orderData.authorizationUrl) {
        throw new Error(orderData.message || "Order creation failed");
      }
      Swal.fire({
        icon: "success",
        title: "Order Created!",
        text: "Redirecting to Paystack for secure payment...",
        showConfirmButton: false,
        timer: 2000
      }).then(() => window.location.href = orderData.authorizationUrl);
    } catch (err) {
      console.error(":x: Order/Payment error:", err);
      Swal.fire({
        icon: "error",
        title: "Order Failed",
        text: err.message,
        confirmButtonColor: "#F58634"
      });
    }
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  // Get stored user data from localStorage
  const userEmail = localStorage.getItem("userEmail");
  const userPhone = localStorage.getItem("userPhone");

  // Prefill email input
  const emailInput = document.getElementById("email");
  if (emailInput && userEmail) {
    emailInput.value = userEmail;
    emailInput.readOnly = true; // Prevent editing but still submits
  }

  // Prefill phone input
  const phoneInput = document.getElementById("phone");
  if (phoneInput && userPhone) {
    phoneInput.value = userPhone;
    phoneInput.readOnly = true; // Prevent editing but still submits
  }
});
  const fullName = localStorage.getItem("userName");

  // Split full name into first and last name
  let firstName = "";
  let lastName = "";

  if (fullName) {
    const nameParts = fullName.trim().split(" ");
    firstName = nameParts[0] || "";
    lastName = nameParts.slice(1).join(" ") || "";
  }

  // Prefill First Name
  const firstInput = document.getElementById("firstName");
  if (firstInput && firstName) {
    firstInput.value = firstName;
    firstInput.readOnly = true; // user can’t change it
  }

  // Prefill Last Name
  const lastInput = document.getElementById("lastName");
  if (lastInput && lastName) {
    lastInput.value = lastName;
    lastInput.readOnly = true;
  }
</script>



















</body>
</html>